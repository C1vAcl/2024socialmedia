# 缺失值处理
## 一.名词定义
缺失值处理是数据分析中的一种技术，用于识别、处理和填补数据集中缺失的数据。这些缺失可能由于数据收集过程中的错误、丢失或不完整等原因造成。
### 1.完全变量与不完全变量
在数据集中，我们常将不含缺失值的变量称为完全变量，数据集中含有缺失值的变量称为不完全变量。
如下图，‘born’列就属于不完全变量，另外两列属于完全变量。
![image](https://github.com/user-attachments/assets/c607d874-d7c5-444f-b79f-3eb61faca59a)
### 2.缺失数据的类型
![image](https://github.com/user-attachments/assets/cf10abd4-63cf-489a-8a0c-cf5ea3612b86)
#### （1）随机丢失
如果数据的缺失与数据集中的其他观测值有关，但缺失本身是随机的，那么这种缺失被称为随机丢失。例如，一个健康调查中，体重较重的人可能更不愿意报告他们的体重，但这种不愿意与他们的其他健康指标无关。
#### （2）完全随机丢失
如果数据的缺失是完全随机的，与数据本身或其他数据无关，那么这种缺失被称为完全随机缺失。例如，一个调查问卷中有10个问题，每个问题被回答的概率完全相同，不受其他问题回答情况的影响。
#### （3）非随机丢失
如果数据的缺失与数据本身有关，且这种关系不是随机的，那么这种缺失被称为非随机缺失。例如，一个关于收入的调查，高收入者可能故意不报告他们的收入，这种缺失与收入水平直接相关

正确判断缺失值的类型，能给我们的工作带来很大的便利，但目前还没有一套规范的缺失值类型判断标准。大多是依据经验或业务进行判断。
## 二、背景分析
在数据科学、统计分析与机器学习等领域，数据集经常包含缺失值。这些缺失值如果不进行适当处理，可能会影响分析结果的准确性与模型的性能。因此，缺失值处理是数据预处理的关键步骤之一。正如那句经典的：“1.：
在统计分析中，缺失值可能会导致分析结果的偏差。例如，如果缺失值不是随机的，那么基于不完整数据的统计推断可能会产生误导。
### 1.机器学习模型的要求：
大多数机器学习算法都要求输入数据是完整的，因为它们依赖于数据中的模式来构建模型。缺失值可能会干扰这些模式的识别。
### 2.法规和伦理的要求：
在某些领域，如医疗保健和金融，法规可能要求对数据进行严格的处理，包括缺失值的处理，以确保数据的隐私和安全性。
### 3.业务决策的影响：
在商业环境中，数据驱动的决策依赖于准确和完整的数据。缺失值可能会影响业务分析的结果，从而影响决策的质量。

缺失值处理在多个学科领域都有应用，包括社会科学、生物统计学、工程学等，这些领域中的研究和实践都依赖于高质量的数据。
## 三.举例
假设有一个数据集，记录了五位同学的数学、英语成绩，其中均有缺失值。
```python
import pandas as pd
import numpy as np
from sklearn.impute import KNNImputer
from sklearn.linear_model import LinearRegression

# 创建示例数据集
data = {
    '学生': ['A', 'B', 'C', 'D', 'E'],
    '数学成绩': [90, np.nan, 85, np.nan, 95],
    '英语成绩': [np.nan, 75, 80, 70, 90]
}
df = pd.DataFrame(data)
```
### 1. 使用平均值填补：
如果数据缺失是随机的，可以使用所有非缺失成绩的平均值来填补缺失值。
```python
# 1. 使用平均值填补
mean_math = df['数学成绩'].mean()
df['数学成绩'].fillna(mean_math, inplace=True)
```
### 2. 使用中位数或众数填补：
对于偏态分布的数据，使用中位数或众数来填补缺失值可能更合适。
```python
# 2. 使用中位数填补
median_english = df['英语成绩'].median()
df['英语成绩'].fillna(median_english, inplace=True)
```
### 3. K最近邻（KNN）填补：
KNN是一种更复杂的填补方法，它根据数据点之间的相似性来预测缺失值。
```python
# 3. K最近邻填补
# 创建KNN填补器
knn_imputer = KNNImputer(n_neighbors=2)
df_knn = pd.DataFrame(knn_imputer.fit_transform(df[['数学成绩', '英语成绩']]), columns=['数学成绩', '英语成绩'])
```
### 4. 多重插补：
多重插补是一种生成多个完整数据集的方法，每个数据集对缺失值有不同的估计。然后，对这些数据集分别进行分析，最后合并结果。这种方法可以减少单一填补方法可能引入的偏差。
```python
# 4. 多重插补（使用statsmodels库）
# 这里我们用简单的线性回归来模拟多重插补
# 假设我们用数学成绩预测英语成绩
model = LinearRegression()
# 训练模型，去掉缺失值
train_data = df.dropna()
X_train = train_data[['数学成绩']]
y_train = train_data['英语成绩']
model.fit(X_train, y_train)

# 预测缺失的英语成绩
missing_english = df[df['英语成绩'].isnull()]
predicted_english = model.predict(missing_english[['数学成绩']])
df.loc[df['英语成绩'].isnull(), '英语成绩'] = predicted_english
```
### 5. 使用模型预测缺失值：
在某些情况下，可以使用回归模型、决策树或其他机器学习算法来预测缺失值。
### 6. 删除含有缺失值的记录：
在缺失值较少的情况下，或者当缺失值对整体数据集的影响不大时，可以选择直接删除含有缺失值的记录。这种方法简单直接，但可能会导致信息的损失。
```python
# 6. 删除含有缺失值的记录
df_dropped = df.dropna()
```
### 7. 使用热卡填补：
热卡填补是一种替换方法，它从数据集中的相似记录中随机选择一个值来填补缺失值。这种方法类似于KNN，但通常不涉及复杂的算法，而是根据一些简单的规则（如年龄、性别等）来选择替换值。
```python
# 7. 热卡填补（随机选择相似记录的值）
# 假设我们用数学成绩的随机值填补缺失的英语成绩
df['英语成绩'].fillna(np.random.choice(df['英语成绩'].dropna()), inplace=True)
```
### 8. 使用冷卡填补：
冷卡填补是一种替换方法，它使用外部数据源中的值来填补缺失值。这种方法适用于当内部数据不足以填补缺失值时，可以从相关的外部数据源中获取信息。
```python
# 8. 冷卡填补（假设有外部数据）
# 这里我们用固定值填补缺失值
df['英语成绩'].fillna(85, inplace=True)
```
### 9. 使用时间序列分析填补：
对于时间序列数据，可以使用时间序列分析方法（如移动平均、指数平滑等）来填补缺失值。这种方法利用了时间序列数据的内在时间依赖性。
```python
# 9. 时间序列分析填补（假设数据是时间序列）
# 这里我们用前一个值填补（向前填充）
df['数学成绩'].fillna(method='ffill', inplace=True)

```
### 10. 使用特定领域的知识填补：
在某些情况下，可以根据特定领域的知识来填补缺失值。例如，在医疗数据分析中，如果某个病人的某个检查结果缺失，可以根据该病人的其他检查结果和临床知识来估计缺失值。

这些例子展示了缺失值处理的多种方法，每种方法都有其适用的场景和优缺点。选择合适的方法需要考虑数据的特性、缺失值的类型以及分析的目标。
## 四.对比分析
缺失值处理是数据预处理的一个重要环节，它与数据清洗、异常值处理、数据插补等概念紧密相关，但它们之间存在一些关键的区别。以下是对这些概念的对比分析：
### 1. 缺失值处理 vs 数据清洗
- **缺失值处理**：专注于识别和处理数据集中的缺失值，目的是填补或删除这些缺失值，以确保数据集的完整性。
- **数据清洗**：是一个更广泛的概念，包括缺失值处理、异常值处理、去除重复数据、格式标准化等多种活动，目的是提高数据的整体质量和可用性。
### 2. 缺失值处理 vs 异常值处理
- **缺失值处理**：主要关注数据集中未记录的信息，即那些标记为缺失或未知的数据点。
- **异常值处理**：关注数据集中明显偏离其他观测值的数据点，这些数据可能是由于错误、偏差或自然变异造成的。异常值处理的目的是识别并处理这些不符合常规的数据点，可能通过删除、替换或保留标记等方式进行。
### 3. 缺失值处理 vs 数据插补
- **缺失值处理**：是一个泛称，包括了多种处理缺失值的策略，如删除、插补、预测等。
- **数据插补**：是缺失值处理的一种具体方法，特指用某种算法或统计技术（如平均值、中位数、K最近邻、回归模型等）来估计并填补缺失值。
### 4. 缺失值处理 vs 数据转换
- **缺失值处理**：主要目的是解决数据集中的信息不完整的问题。
- **数据转换**：涉及将数据转换成适合分析的格式或尺度，如归一化、标准化、编码分类变量等，这有助于提高数据分析或模型训练的效果。
### 5. 缺失值处理 vs 数据缩减
- **缺失值处理**：旨在解决数据集中的缺失问题，保持数据的完整性。
- **数据缩减**：是一种减少数据集大小的技术，如特征选择、降维等，目的是简化模型，减少计算复杂度，但与处理缺失值无直接关联。
### 6. 缺失值处理 vs 数据增强
- **缺失值处理**：关注于已有数据集中缺失信息的处理。
- **数据增强**：通常用于机器学习中，通过生成新的数据点来增加数据集的多样性和数量，如图像旋转、文本同义词替换等，以提高模型的泛化能力。

通过这些对比，我们可以更清晰地理解缺失值处理在数据预处理中的位置和作用，以及它与其他数据处理活动的区别。正确地区分和应用这些概念，对于确保数据分析和机器学习项目的成功率至关重要。
## 五.简明总结
缺失值处理是确保数据分析准确性和机器学习模型有效性的重要步骤。它包括多种方法，从简单的删除或填补到复杂的预测模型，每种方法都有其适用场景和优缺点。正确选择和应用缺失值处理方法，对于提高数据分析的质量和可靠性至关重要。
